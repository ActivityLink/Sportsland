<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActivityLink - 管理後台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: #f8fafc;
        }

        .sidebar { transition: all 0.3s ease; width: 260px; }
        .sidebar.collapsed { width: 80px; }
        .main-content { transition: all 0.3s ease; margin-left: 260px; }
        .main-content.expanded { margin-left: 80px; }
        .nav-link.active { background-color: #3b82f6; color: white; }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Modal Styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000;
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: white;
            width: 90%; max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 1.5rem;
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- 側邊欄 -->
    <aside id="sidebar" class="sidebar fixed top-0 left-0 h-full bg-slate-900 text-white z-50 overflow-y-auto shadow-xl">
        <div class="p-6 flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-link text-white"></i>
            </div>
            <span class="text-xl font-bold logo-text">ActivityLink</span>
        </div>

        <nav class="mt-6 px-4 space-y-2">
            <a href="#" onclick="switchView('dashboard')" class="nav-link flex items-center gap-4 p-3 rounded-xl transition-all hover:bg-slate-800">
                <i class="fas fa-chart-pie w-5 text-center"></i>
                <span class="nav-text">儀表板</span>
            </a>
            <a href="#" onclick="switchView('activities')" class="nav-link flex items-center gap-4 p-3 rounded-xl transition-all hover:bg-slate-800">
                <i class="fas fa-calendar-check w-5 text-center"></i>
                <span class="nav-text">活動管理</span>
            </a>
            <a href="#" onclick="switchView('line-settings')" class="nav-link flex items-center gap-4 p-3 rounded-xl transition-all hover:bg-slate-800">
                <i class="fab fa-line w-5 text-center text-green-400"></i>
                <span class="nav-text">LINE 外掛設定</span>
            </a>
            <a href="#" onclick="switchView('analytics')" class="nav-link flex items-center gap-4 p-3 rounded-xl transition-all hover:bg-slate-800">
                <i class="fas fa-users w-5 text-center"></i>
                <span class="nav-text">用戶分析</span>
            </a>
            <div class="pt-4 mt-4 border-t border-slate-800">
                <a href="#" onclick="switchView('settings')" class="nav-link flex items-center gap-4 p-3 rounded-xl transition-all hover:bg-slate-800">
                    <i class="fas fa-cog w-5 text-center text-slate-400"></i>
                    <span class="nav-text text-slate-400">系統設定</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- 主要內容區 -->
    <main id="main-content" class="main-content min-h-screen">
        <nav id="topnav" class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 py-3 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button id="sidebar-toggle" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500">
                    <i class="fas fa-bars text-lg"></i>
                </button>
                <div class="text-slate-700 font-semibold hidden md:block">
                    單日課程管理 <span class="text-slate-400 font-normal mx-2">/</span> <span class="text-sm font-normal text-slate-500">SingleCourses</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p class="text-sm font-semibold text-slate-700">管理員</p>
                </div>
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">JD</div>
            </div>
        </nav>

        <div class="p-6">
            <div id="app-content"></div>
        </div>
    </main>

    <!-- 新增課程 Modal -->
    <div id="course-modal" class="modal-overlay">
        <div class="modal-content shadow-2xl animate-in zoom-in-95 duration-200">
            <div class="sticky top-0 bg-white border-b px-8 py-4 flex items-center justify-between z-10">
                <div>
                    <h2 class="text-xl font-bold text-slate-800">新增單日課程</h2>
                    <p class="text-xs text-slate-500">Sheet: SingleCourses | ID: 16NKF...o9_D4w</p>
                </div>
                <button onclick="closeCourseModal()" class="w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="course-form" class="p-8 space-y-10">
                <!-- 1. 基本資訊 -->
                <section>
                    <h3 class="flex items-center gap-2 font-bold text-slate-800 mb-4 pb-2 border-b border-slate-100">
                        <i class="fas fa-info-circle text-blue-500"></i> 基本資訊
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-slate-600 mb-1">課程名稱 *</label>
                            <input type="text" name="courseName" required class="w-full border border-slate-200 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">運動類別</label>
                            <select name="category" class="w-full border border-slate-200 rounded-lg p-2.5">
                                <option value="籃球">籃球</option>
                                <option value="羽球">羽球</option>
                                <option value="足球">足球</option>
                                <option value="網球">網球</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">年齡分級</label>
                            <input type="text" name="ageGroup" placeholder="例如：U12" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">難度等級</label>
                            <select name="difficulty" class="w-full border border-slate-200 rounded-lg p-2.5">
                                <option value="初階">初階</option>
                                <option value="中階">中階</option>
                                <option value="高階">高階</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">標籤分類</label>
                            <input type="text" name="tags" placeholder="標籤以逗號隔開" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                    </div>
                </section>

                <!-- 2. 時間與地點 -->
                <section>
                    <h3 class="flex items-center gap-2 font-bold text-slate-800 mb-4 pb-2 border-b border-slate-100">
                        <i class="fas fa-clock text-blue-500"></i> 時間與場地
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-slate-600 mb-1">開放報名日 ~ 截止報名日</label>
                            <div class="flex items-center gap-2">
                                <input type="date" name="regStart" class="w-full border border-slate-200 rounded-lg p-2.5">
                                <span>-</span>
                                <input type="date" name="regEnd" class="w-full border border-slate-200 rounded-lg p-2.5">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">課程日期 *</label>
                            <input type="date" name="courseDate" required class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">時長 (分鐘)</label>
                            <input type="number" name="duration" value="60" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">開始時間</label>
                            <input type="time" name="startTime" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">結束時間</label>
                            <input type="time" name="endTime" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">教練姓名 (ID)</label>
                            <input type="text" name="coachInfo" placeholder="姓名 (ID)" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">場地名稱 (區域)</label>
                            <input type="text" name="venueInfo" placeholder="場地 (區域)" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                    </div>
                </section>

                <!-- 3. 價格與名額 -->
                <section>
                    <h3 class="flex items-center gap-2 font-bold text-slate-800 mb-4 pb-2 border-b border-slate-100">
                        <i class="fas fa-dollar-sign text-blue-500"></i> 價格與名額
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">原價</label>
                            <input type="number" name="price" placeholder="0" class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">早鳥價 (截止日)</label>
                            <div class="flex flex-col gap-1">
                                <input type="number" name="earlyBirdPrice" placeholder="早鳥價" class="w-full border border-slate-200 rounded-lg p-2.5">
                                <input type="date" name="earlyBirdEnd" class="text-xs border border-slate-200 rounded-lg p-1.5">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">會員價 / 親友價</label>
                            <div class="flex gap-1">
                                <input type="number" name="memberPrice" placeholder="會員" class="w-1/2 border border-slate-200 rounded-lg p-2.5 text-sm">
                                <input type="number" name="friendPrice" placeholder="親友" class="w-1/2 border border-slate-200 rounded-lg p-2.5 text-sm">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">名額 (總額/最少)</label>
                            <div class="flex gap-1">
                                <input type="number" name="quota" placeholder="總名額" class="w-1/2 border border-slate-200 rounded-lg p-2.5 text-sm">
                                <input type="number" name="minClass" placeholder="最少" class="w-1/2 border border-slate-200 rounded-lg p-2.5 text-sm">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 4. 詳細資料 -->
                <section>
                    <h3 class="flex items-center gap-2 font-bold text-slate-800 mb-4 pb-2 border-b border-slate-100">
                        <i class="fas fa-file-alt text-blue-500"></i> 詳細內容與多媒體
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">封面圖片網址 (URL)</label>
                            <input type="text" name="coverImage" placeholder="https://..." class="w-full border border-slate-200 rounded-lg p-2.5">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">課程亮點</label>
                                <textarea name="highlights" rows="3" class="w-full border border-slate-200 rounded-lg p-2.5 text-sm"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">適合對象</label>
                                <textarea name="suitableFor" rows="3" class="w-full border border-slate-200 rounded-lg p-2.5 text-sm"></textarea>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">課程內容</label>
                            <textarea name="content" rows="4" class="w-full border border-slate-200 rounded-lg p-2.5 text-sm"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">注意事項</label>
                            <textarea name="notes" rows="2" class="w-full border border-slate-200 rounded-lg p-2.5 text-sm"></textarea>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">性別限制</label>
                                <select name="genderLimit" class="w-full border border-slate-200 rounded-lg p-2.5">
                                    <option value="無">無</option>
                                    <option value="限男性">限男性</option>
                                    <option value="限女性">限女性</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">課程狀態</label>
                                <select name="status" class="w-full border border-slate-200 rounded-lg p-2.5">
                                    <option value="草稿">草稿</option>
                                    <option value="發佈">發佈</option>
                                    <option value="隱藏">隱藏</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">排序權重</label>
                                <input type="number" name="weight" value="0" class="w-full border border-slate-200 rounded-lg p-2.5">
                            </div>
                        </div>
                    </div>
                </section>

                <div class="sticky bottom-0 bg-white pt-6 pb-2 border-t flex justify-end gap-3">
                    <button type="button" onclick="closeCourseModal()" class="px-6 py-2.5 rounded-xl border border-slate-200 text-slate-500 hover:bg-slate-50 transition-all font-medium">取消</button>
                    <button type="submit" class="px-8 py-2.5 rounded-xl bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-100 transition-all font-bold">確認儲存課程</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const appContent = document.getElementById('app-content');
        const courseModal = document.getElementById('course-modal');
        const courseForm = document.getElementById('course-form');

        // 常數：Google Sheet 資訊
        const SPREADSHEET_ID = '16NKFioe-lrYmpFv20tYEg6p6uo9_D4wSsS2YoiUWKko';
        const SHEET_NAME = 'SingleCourses';

        // 側邊欄切換
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            const isCollapsed = sidebar.classList.contains('collapsed');
            document.querySelectorAll('.nav-text, .logo-text').forEach(el => {
                el.style.display = isCollapsed ? 'none' : 'block';
            });
        });

        // 彈窗控制
        function openCourseModal() {
            courseModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeCourseModal() {
            courseModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            courseForm.reset();
        }

        // 表單提交處理
        courseForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(courseForm);
            const data = Object.fromEntries(formData.entries());
            
            console.log('準備提交課程數據至 SingleCourses:', data);
            
            /* 提示：這裡您可以串接 Google Apps Script
            google.script.run.withSuccessHandler(() => {
                alert('課程已成功儲存至 Google Sheet！');
                closeCourseModal();
                switchView('activities');
            }).addNewCourse(data);
            */
            
            alert('課程已暫存 (模擬成功)！\n詳細資訊已輸出至 Console。\n目標 Sheet: ' + SHEET_NAME);
            closeCourseModal();
        });

        const views = {
            dashboard: `
                <div class="animate-in fade-in duration-500">
                    <h1 class="text-2xl font-bold text-slate-800 mb-6">數據概覽</h1>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        ${generateStatCard('今日報名數', '24', 'fa-user-edit', 'text-blue-500', '+5')}
                        ${generateStatCard('總課程數', '156', 'fa-book', 'text-indigo-500', '0')}
                        ${generateStatCard('場地使用率', '82%', 'fa-map-marker-alt', 'text-green-500', '+2%')}
                        ${generateStatCard('待處理候補', '12', 'fa-clock', 'text-orange-500', '-3')}
                    </div>
                </div>
            `,
            activities: `
                <div class="animate-in slide-in-from-bottom-4 duration-500">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-800">單日課程管理</h1>
                            <p class="text-slate-500 text-sm">管理 SingleCourses 表格中的所有課程資料</p>
                        </div>
                        <div class="flex gap-2">
                            <button class="bg-slate-100 text-slate-600 px-4 py-2 rounded-lg hover:bg-slate-200 transition-colors flex items-center gap-2 text-sm font-medium">
                                <i class="fas fa-file-export"></i> 匯出 CSV
                            </button>
                            <button onclick="openCourseModal()" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-100 transition-all flex items-center gap-2 font-bold">
                                <i class="fas fa-plus"></i> 新增單日課程
                            </button>
                        </div>
                    </div>

                    <!-- 快速過濾 -->
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-6 flex flex-wrap gap-4 items-center">
                        <select class="border border-slate-200 rounded-lg px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-blue-100">
                            <option>所有運動類別</option>
                            <option>籃球</option>
                            <option>羽球</option>
                        </select>
                        <select class="border border-slate-200 rounded-lg px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-blue-100">
                            <option>所有狀態</option>
                            <option>發佈中</option>
                            <option>草稿</option>
                        </select>
                        <div class="flex-grow"></div>
                        <div class="relative w-64">
                            <i class="fas fa-search absolute left-3 top-2.5 text-slate-400 text-xs"></i>
                            <input type="text" placeholder="搜尋課程名稱或教練..." class="w-full pl-9 pr-4 py-2 border border-slate-200 rounded-lg text-sm">
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider">
                                <tr>
                                    <th class="px-6 py-4 font-bold">課程資訊 / 日期</th>
                                    <th class="px-6 py-4 font-bold">場地 & 教練</th>
                                    <th class="px-6 py-4 font-bold">名額狀態</th>
                                    <th class="px-6 py-4 font-bold">價格 (原/會)</th>
                                    <th class="px-6 py-4 font-bold text-right">操作</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100 text-sm">
                                ${[1, 2, 3].map(i => `
                                    <tr class="hover:bg-slate-50/50 transition-colors">
                                        <td class="px-6 py-5">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-slate-100 rounded-lg overflow-hidden flex-shrink-0 flex items-center justify-center">
                                                    <i class="fas fa-image text-slate-300"></i>
                                                </div>
                                                <div>
                                                    <div class="font-bold text-slate-700">台北週末籃球菁英班 ${i}</div>
                                                    <div class="text-xs text-blue-500 mt-0.5"><i class="far fa-calendar-alt mr-1"></i> 2026-03-15 (日)</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-5">
                                            <div class="text-slate-600 font-medium">中正運動中心 (A區)</div>
                                            <div class="text-xs text-slate-400 mt-1"><i class="fas fa-user-tie mr-1"></i> 王大明 教練</div>
                                        </td>
                                        <td class="px-6 py-5">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-24 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                                                    <div class="bg-green-500 h-full" style="width: 70%"></div>
                                                </div>
                                                <span class="text-[10px] font-bold text-slate-500">14/20</span>
                                            </div>
                                            <span class="text-[10px] bg-green-100 text-green-600 px-1.5 py-0.5 rounded font-bold uppercase tracking-tight">報名中</span>
                                        </td>
                                        <td class="px-6 py-5">
                                            <div class="font-mono">$800 / <span class="text-blue-600 font-bold">$650</span></div>
                                        </td>
                                        <td class="px-6 py-5 text-right">
                                            <button class="p-2 hover:bg-blue-50 text-blue-500 rounded-lg transition-colors"><i class="fas fa-edit"></i></button>
                                            <button class="p-2 hover:bg-slate-50 text-slate-400 rounded-lg transition-colors"><i class="fas fa-ellipsis-v"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            'line-settings': `<div class="p-8 text-center text-slate-400">LINE 設定開發中</div>`,
            analytics: `<div class="p-8 text-center text-slate-400">數據分析開發中</div>`,
            settings: `<div class="p-8 text-center text-slate-400">系統設定開發中</div>`
        };

        function generateStatCard(title, value, icon, iconColor, trend) {
            return `
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-10 h-10 bg-slate-50 rounded-lg flex items-center justify-center ${iconColor}"><i class="fas ${icon}"></i></div>
                        <span class="text-xs font-bold ${trend.startsWith('+') ? 'text-green-500' : (trend === '0' ? 'text-slate-400' : 'text-red-500')}">
                            ${trend}
                        </span>
                    </div>
                    <p class="text-slate-400 text-xs">${title}</p>
                    <h2 class="text-2xl font-bold text-slate-800">${value}</h2>
                </div>
            `;
        }

        function switchView(viewName) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                const onclickAttr = link.getAttribute('onclick');
                if (onclickAttr && onclickAttr.includes(viewName)) link.classList.add('active');
            });
            appContent.innerHTML = `<div class="flex flex-col items-center justify-center min-h-[50vh]"><div class="loading-spinner mb-4"></div><p class="text-slate-400">讀取中...</p></div>`;
            setTimeout(() => {
                appContent.innerHTML = views[viewName] || views.dashboard;
            }, 300);
        }

        window.onload = () => switchView('activities');
    </script>
</body>
</html>
