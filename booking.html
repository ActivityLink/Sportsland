<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>課程預約</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 flex justify-center">
<div class="w-full max-w-[640px] bg-white min-h-screen p-4">

<h1 class="text-xl font-bold mb-4">課程預約</h1>

<div id="error" class="hidden p-4 bg-red-50 text-red-600 rounded-lg mb-4"></div>

<div id="courseBox" class="p-4 border rounded-xl mb-4"></div>

<div id="memberBox" class="p-4 border rounded-xl mb-4"></div>

<div id="equipmentBox" class="p-4 border rounded-xl mb-4"></div>

<button class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">
  確認送出預約
</button>

</div>

<script>
const API = 'https://aged-rice-2438.wetw-net3.workers.dev/';
const p = new URLSearchParams(location.search);
const courseId = p.get('id');
const courseType = p.get('type') || 'single';

async function init(){
  try{
    const res = await fetch(`${API}?type=booking_init&id=${courseId}&sheet=SingleCourses`);
    const j = await res.json();

    if(!j.data || !j.data.course){
      showError('找不到課程資料');
      return;
    }

    renderCourse(j.data.course);
    renderMember(j.data.member);
    renderEquipment(j.data.config?.equipment_list?.Global || []);
  }catch(e){
    showError('載入失敗');
  }
}

function showError(msg){
  const el = document.getElementById('error');
  el.innerText = msg;
  el.classList.remove('hidden');
}

function renderCourse(c){
  document.getElementById('courseBox').innerHTML = `
    <div class="font-bold text-lg">${c.courseName}</div>
    <div class="text-sm text-gray-600">${c.courseDate} ${c.startTime}</div>
  `;
}

function renderMember(m){
  document.getElementById('memberBox').innerHTML = `
    <div class="font-bold mb-2">預約對象</div>
    <div>${m?.data?.name || ''}</div>
  `;
}

function renderEquipment(list){
  if(!list.length){
    document.getElementById('equipmentBox').innerHTML =
      `<div class="text-gray-400">目前沒有可租用設備</div>`;
    return;
  }
  document.getElementById('equipmentBox').innerHTML = `
    <div class="font-bold mb-2">租用設備</div>
    ${list.map(e=>`
      <label class="flex items-center gap-2">
        <input type="checkbox"> ${e.name} (+${e.price})
      </label>
    `).join('')}
  `;
}

init();
</script>
</body>
</html>
